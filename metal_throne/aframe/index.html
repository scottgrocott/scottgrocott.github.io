<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>A-Frame Greybox Scene</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-family: Arial, sans-serif;
      font-size: 24px;
      z-index: 1000;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="loading">Loading assets...</div>
  
  <a-scene>
    <!-- Sky -->
    <a-sky color="#87CEEB" radius="10000"></a-sky>
    
    <!-- Lighting -->
    <a-light type="ambient" color="#BBB"></a-light>
    <a-light type="directional" color="#FFF" intensity="0.6" position="1 1 0"></a-light>
    
    <!-- Ground plane -->
    <a-plane position="0 0 0" rotation="-90 0 0" width="10000" height="10000" color="tan" shadow></a-plane>
    
    <!-- Assets will be dynamically loaded here -->
    <a-assets id="asset-container" timeout="30000">
    </a-assets>
    
    <!-- Entities will be added here dynamically -->
    <a-entity id="scene-container"></a-entity>
    
    <!-- Camera with WASD controls -->
    <a-entity id="rig" position="0 1.6 0">
      <a-entity camera="far: 20000" look-controls wasd-controls="acceleration: 100;fly: true" position="0 0 0"></a-entity>
    </a-entity>
  </a-scene>

  <script>
    //const JSON_URL = 'https://scottgrocott.github.io/metal_throne/assets/json/greybox_assets.json';
    const JSON_URL = 'http://localhost:81/metal_throne/assets/json/greybox_assets_dev.json';
    async function loadScene() {
      try {
        const response = await fetch(JSON_URL);
        const data = await response.json();
        
        const assetContainer = document.querySelector('#asset-container');
        const sceneContainer = document.querySelector('#scene-container');
        
        // Load all model assets
        data.assets.forEach(asset => {
          const assetItem = document.createElement('a-asset-item');
          assetItem.setAttribute('id', asset.id);
          assetItem.setAttribute('src', asset.src);
          assetContainer.appendChild(assetItem);
        });
        
        // Wait for assets to load
        assetContainer.addEventListener('loaded', () => {
          document.querySelector('#loading').style.display = 'none';
        });
        
        // Create building entities
        data.buildings.forEach(building => {
  /*      
 if (building.id == 'green') {
  let tempxyz = building.position.split(' ');
  tempxyz[1] = 194.8;
  building.position = tempxyz.join(' ');
  console.log('Adding green:', tempxyz);
 
  building.setAttribute('position', {
    x: building.position.x,
    y: 194.240,
    z: building.position.z
  });
 
}
 */ 
          const entity = document.createElement('a-entity');
          entity.setAttribute('id', building.id);
          entity.setAttribute('gltf-model', building.model);
          entity.setAttribute('position', building.position);
          entity.setAttribute('class', building.class);
          sceneContainer.appendChild(entity);
        });
        
        // Create tank entities
        /*
        data.tanks.forEach((tank, index) => {
          const entity = document.createElement('a-entity');
          entity.setAttribute('id', `tank-${index}`);
          entity.setAttribute('geometry', tank.geometry);
          entity.setAttribute('material', tank.material);
          entity.setAttribute('scale', tank.scale);
          entity.setAttribute('position', tank.position);
          entity.setAttribute('class', tank.class);
          sceneContainer.appendChild(entity);
        });
        */
        console.log('Scene loaded successfully!');
        
      } catch (error) {
        console.error('Error loading scene:', error);
        document.querySelector('#loading').textContent = 'Error loading scene. Check console for details.';
      }
    }
    
    // Load the scene when the page loads
    window.addEventListener('load', loadScene);
  </script>
</body>
</html>